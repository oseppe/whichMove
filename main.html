<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="main.css">
	<title>Which Move</title>
</head>
<body>
	<header>
	</header>
	<main>
		<div class="row">
			<div id="pane-left" class="col s12 m6 l6 line-border">
				<!-- Canvas -->
				<div id="canvas-container" class="s12 m6 l6 center-align">
					<canvas id="canvas" height="300">
						Please update your browser or download the <a href="https://www.google.com/chrome/browser/desktop/index.html">latest Google Chrome browser</a>
					</canvas>	
				</div>
				<div class="s12 m6 l6">
					<!-- logo / branding -->
					<div id="logo-container">
						a
					</div>
					<!-- tally -->
					<div id="votes-tally" class="row center-align">
						<div id="votes-tally-margin-left" class="col s1">
							a
						</div>
						<div id="votes-tally-left" class="col s2">
							<i class="material-icons teal-darken-2">arrow_back</i>
							<div id="votes-count-left" class="votes-count">7</div>
						</div>
						<div id="votes-tally-up" class="col s2">
							<i class="material-icons teal-darken-2">arrow_upward</i>
							<div id="votes-count-up" class="votes-count">7</div>
						</div>
						<div id="votes-tally-right" class="col s2">
							<i class="material-icons teal-darken-2">arrow_forward</i>
							<div id="votes-count-right" class="votes-count">7</div>
						</div>
						<div id="votes-tally-down" class="col s2">
							<i class="material-icons teal-darken-2">arrow_downward</i>
							<div id="votes-count-down" class="votes-count">7</div>
						</div>
						<div id="votes-tally-stay" class="col s2">
							<i class="material-icons teal-darken-2">stop</i>
							<div id="votes-count-stay" class="votes-count">7</div>
						</div>
						<div id="votes-tally-margin-right" class="col s1">
							a
						</div>
					</div>
					<!-- vote list -->
					<div id="votes-list" class="hide-on-small-only">
					</div>
				</div>
			</div>
			<div id="pane-right" class="col s12 m6 l6">
				<div id="chat-ui">
					<!-- chat screen -->
					<div id="chat-screen" class="">
					</div>
					<!-- Run interface -->
					<div class="row">
						<div id="container-runner-input" class="col s12 m12 l12">
							<input id="runner-input" type="text" name="" placeholder="Run how many times?">
						</div>
            <div id="container-runner-settings-btn" class="col s6 m6 l6 valign-wrapper" >
              <i id="btn-runner-settings" class="material-icons md-24 teal-darken-2">settings</i>
            </div>
						<div id="container-runner-send-btn" class="col s6 m6 l6">
							<button id="runner-run-btn" class="btn waves-effect" type="submit" name="action">
			    			RUN
			  			</button>
			  			<!--  -->
						</div>
					</div>
					<!-- Chat Interface -->
					<div class="row" style="display: none;">
						<div id="container-chat-input" class="col s12 m12 l12">
							<input id="chat-input" type="text" name="" placeholder="type in command">
						</div>
						<div id="container-chat-settings-btn" class="col s6 m6 l6 valign-wrapper" >
							<i id="btn-chat-settings" class="material-icons md-24 teal-darken-2">settings</i>
						</div>
						<div id="container-chat-send-btn" class="col s6 m6 l6">
							<button id="chat-send-btn" class="btn waves-effect" type="submit" name="action">
			    			chat
			  			</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</main>
	<footer>
		
	</footer>
	<script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
	<script type="text/javascript" src="js/chatScreen.js"></script>
	<script type="text/javascript" src="js/movesArbiter.js"></script>
	<script type="text/javascript" src="js/movesGenerator.js"></script>
	<script type="text/javascript" src="js/runner.js"></script>
	<script type="text/javascript" src="js/sprite.js"></script>
	<script type="text/javascript" src="js/spriteHandler.js"></script>
	<script type="text/javascript" src="js/tallyBoard.js"></script>
	<script type="text/javascript" src="js/voteBoard.js"></script>
	<script type="text/javascript">
		'use strict';

		let canvas = document.getElementById('canvas');

		let spriteHeight = 20;
		let spriteWidth = 20;
		let startY = computeCenter(canvas.height, spriteHeight);
		let startX = computeCenter(canvas.width, spriteWidth);
		
		const sprite = new Sprite(startX, startY, spriteWidth, spriteHeight);

  	const spriteHandler = new SpriteHandler(sprite, canvas.width, canvas.height);

    const movesArbiter = new MovesArbiter();

    const movesGenerator = new MovesGenerator();

    const chatScreenElem = document.getElementById('chat-screen');
		const chatScreen = new ChatScreen(chatScreenElem);

    const tallyBoardElem = document.getElementById('votes-tally');
    const tallyBoard = new TallyBoard(tallyBoardElem);

    const voteBoardElem = document.getElementById('votes-list');
    const voteBoard = new VoteBoard(voteBoardElem);

		const runnerInputElem = document.getElementById('runner-input');
		const runner = new Runner(spriteHandler, 
										movesArbiter, 
										movesGenerator,
										chatScreen,
                    tallyBoard,
                    voteBoard,
										runnerInputElem);

		const sendChatUsingEnterKey = (event) => {
			if (event.keyCode == 13) {
				sendChat();
			}
		}

		const sendChat = () => {
			let chatBox = document.getElementById('chat-input');
			let message = chatBox.value;

			chatScreen.addEntry(message);
			chatScreen.scrollToLatestEntry();
			spriteHandler.move(message);
			chatBox.value = '';
		}

		const runRunner = () => runner.run();
			
		const runRunnerUsingEnterKey = (event) => {
			if(event.keyCode == 13) {
				runRunner();
			}	
		}

		draw();

		// Register events
		// Chat related events
		document.getElementById('chat-send-btn').addEventListener('click', sendChat);
		document.getElementById('chat-input').addEventListener('keypress', sendChatUsingEnterKey);

		// Runner related events
		document.getElementById('runner-run-btn').addEventListener('click', runRunner);
		document.getElementById('runner-input').addEventListener('keypress', runRunnerUsingEnterKey);

		// Functions
		function draw() {
	      
      if (canvas.getContext) {
        let context = canvas.getContext('2d');

        context.clearRect(0,0, canvas.width, canvas.height);

        sprite.flicker().draw(context);

        window.requestAnimationFrame(draw);
      }
    }

    function computeCenter(canvasLength, figureLength) {
      return (canvasLength / 2) - (figureLength / 2);
    }
	</script>
</body>
</html>